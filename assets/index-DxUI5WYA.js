(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))f(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&f(s)}).observe(document,{childList:!0,subtree:!0});function a(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function f(e){if(e.ep)return;e.ep=!0;const r=a(e);fetch(e.href,r)}})();const l=document.querySelector("[recording-button]"),b=document.getElementById("audio"),C=document.getElementById("facecam"),k=document.getElementById("screen"),n=document.querySelector("[output-canvas]"),u=n.getContext("2d");let m=null,o=null,i=null,d=null,p=[];const g=document.createElement("video"),h=document.createElement("video");g.autoplay=!0;h.autoplay=!0;function w(){return{audio:b.checked,screen:k.checked,facecam:C.checked}}function S(c){const t=w();let a={audio:t.audio,video:{}};return c==="screen"&&t.screen?a.video={width:1920,height:1080}:c==="facecam"&&t.facecam&&(a.video={width:720,height:480}),a}l==null||l.addEventListener("click",()=>{!o&&!i?L():M()});async function L(){l.textContent="Stop Recording",n.classList.remove("hidden");const c=w();try{c.facecam&&(await R(),o&&y(o,g)),c.screen&&(await E(),i&&y(i,h));const t=new MediaStream;o&&o.getAudioTracks().forEach(e=>{t.addTrack(e)}),i&&i.getAudioTracks().forEach(e=>{t.addTrack(e)});const a=n.captureStream(30),f=new MediaStream([...a.getVideoTracks(),...t.getAudioTracks()]);d=new MediaRecorder(f),d.ondataavailable=e=>{e.data.size>0&&p.push(e.data)},d.onstop=()=>{const e=new Blob(p,{type:"video/webm"}),r=URL.createObjectURL(e),s=document.createElement("a");s.style.display="none",s.href=r,s.download="recording.webm",document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(r),p=[]},d.start(),I()}catch(t){console.error("Error accessing media devices:",t)}}async function R(){try{o=await navigator.mediaDevices.getUserMedia(S("facecam"))}catch(c){console.error(c)}}async function E(){try{i=await navigator.mediaDevices.getDisplayMedia(S("screen"))}catch(c){console.error(c)}}function M(){d&&(d.stop(),d=null),o&&(v(o),o=null),i&&(v(i),i=null),O(),m&&(cancelAnimationFrame(m),m=null)}function y(c,t){t&&(t.srcObject=c)}function v(c){c.getTracks().forEach(t=>t.stop())}function O(){l&&(l.textContent="Start Recording"),u&&(u.reset(),n.classList.add("hidden"))}function I(){function c(){if(u){if(u.clearRect(0,0,n.width,n.height),i&&h.readyState>=2&&u.drawImage(h,0,0,n.width,n.height),o&&g.readyState>=2){const t=n.width/4,a=n.height/4;u.drawImage(g,n.width-t-10,n.height-a-10,t,a)}m=requestAnimationFrame(c)}}c()}
